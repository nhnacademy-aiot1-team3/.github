# Rule Engine
  - 환경 : 스프링? O X?
  - 역할 : 실시간 센서의 측정 데이터들을 각 센서 타입별 설정 값에 기반해서 제어에 활용한 후 알맞게 가공 후 데이터베이스에 저장
  - 설계 방식 : flow based model

## Flow
### 0. 진입 전
  - RabbitMQ Consumer application으로 부터 가공되지 않은 데이터를 받음
    
### 1. 등록 센서 확인
  - topic에 있는 센서의 아이디 추출
  - 추출한 아이디로 데이터베이스의 센서테이블에 포함되어 있는지 검사
  - 없으면 데이터베이스에 추가
  
### 2. 결측치 필터링
  - payload의 value값이 NaN 또는 Null과 같이 undefined 인지 확인
  - 결측치에 해당하면 7번으로 이동
  - 그 외에는 3번으로 이동
  - 에러로그 테이블에 에러 타입 추가 할거? <--
    
### 3. 오탐탐지 필터링
  - payload의 value값이 오류에 해당하는 값인지 판별(ex. temperature value : 500)
  - 오류로 판정 시 7번으로 이동
  - 그 외에는 4번으로 이동
  - 오탐 기준 정하기 <--
  - (오류탐지 하는 방법 아직..) <--
  - 에러로그 테이블에 에러 타입 추가 할거? <--
    
### 4. 기능별 분류 설정
  - 데이터베이스에서 센서의 설정된 기능(function_id)을 확인
  - function_id별로 흐름 제어
    - function_id : 0 (read_only) -> 7번으로 이동
    - functoin_id : 1 (basic) -> 5번으로 이동
    - function_id : 2 (ai) -> 4-1번으로 이동

### 4.1 AI 설정
  - 센서 타입별 학습된 AI모델 사용
  - 실시간 데이터를 AI모델에 적용
  - 적용 후 결과를 5번으로 이동

### 5. 제어 유무 판별
  - paload의 값과 데이터베이스에서 가져온 센서별 설정값을 이용해 제어 여부 판단
  - 제어가 필요할 시 원본 데이터 대신 "어떤 장치가 어떤 제어를 할 것인가"에 대한 데이터를 6번으로 이동 
  - 제어 여부와 상관없이 원본 데이터는 7번으로 이동

### 6. 제어
  - 데이터베이스의 센서,디바이스,제어행동 테이블을 참고해 5번에서 넘어온 데이터를 실행
  - 제어 로그 7번으로 이동

### 7. 데이터 가공
  - 들어온 데이터를 데이터 베이스에 저장할 각 테이블 형식에 맞게 가공
  - 8번으로 이동

### 8. 데이터베이스에 가공 데이터 추가
  - 들어온 데이터를 데이터베이스의 각 테이블에 추가
  - error_log, device_log, sensor_data_log 테이블
